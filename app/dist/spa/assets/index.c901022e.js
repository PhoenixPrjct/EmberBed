import{ah as h,aW as x,a_ as A,b_ as E,aR as f}from"./index.3ba0a9f2.js";var s={},$=h&&h.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),F=h&&h.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),l=h&&h.__decorate||function(n,e,t,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,e,t,r);else for(var w=n.length-1;w>=0;w--)(a=n[w])&&(o=(i<3?a(o):i>3?a(e,t,o):a(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},O=h&&h.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.hasOwnProperty.call(n,t)&&$(e,n,t);return F(e,n),e},_=h&&h.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(s,"__esModule",{value:!0});s.deserializeUnchecked=s.deserialize=s.serialize=s.BinaryReader=s.BinaryWriter=s.BorshError=s.baseDecode=s.baseEncode=void 0;const b=_(x.exports),p=_(A),D=O(E),P=typeof h.TextDecoder!="function"?D.TextDecoder:h.TextDecoder,S=new P("utf-8",{fatal:!0});function I(n){return typeof n=="string"&&(n=f.Buffer.from(n,"utf8")),p.default.encode(f.Buffer.from(n))}s.baseEncode=I;function v(n){return f.Buffer.from(p.default.decode(n))}s.baseDecode=v;const y=1024;class u extends Error{constructor(e){super(e),this.fieldPath=[],this.originalMessage=e}addToFieldPath(e){this.fieldPath.splice(0,0,e),this.message=this.originalMessage+": "+this.fieldPath.join(".")}}s.BorshError=u;class z{constructor(){this.buf=f.Buffer.alloc(y),this.length=0}maybeResize(){this.buf.length<16+this.length&&(this.buf=f.Buffer.concat([this.buf,f.Buffer.alloc(y)]))}writeU8(e){this.maybeResize(),this.buf.writeUInt8(e,this.length),this.length+=1}writeU16(e){this.maybeResize(),this.buf.writeUInt16LE(e,this.length),this.length+=2}writeU32(e){this.maybeResize(),this.buf.writeUInt32LE(e,this.length),this.length+=4}writeU64(e){this.maybeResize(),this.writeBuffer(f.Buffer.from(new b.default(e).toArray("le",8)))}writeU128(e){this.maybeResize(),this.writeBuffer(f.Buffer.from(new b.default(e).toArray("le",16)))}writeU256(e){this.maybeResize(),this.writeBuffer(f.Buffer.from(new b.default(e).toArray("le",32)))}writeU512(e){this.maybeResize(),this.writeBuffer(f.Buffer.from(new b.default(e).toArray("le",64)))}writeBuffer(e){this.buf=f.Buffer.concat([f.Buffer.from(this.buf.subarray(0,this.length)),e,f.Buffer.alloc(y)]),this.length+=e.length}writeString(e){this.maybeResize();const t=f.Buffer.from(e,"utf8");this.writeU32(t.length),this.writeBuffer(t)}writeFixedArray(e){this.writeBuffer(f.Buffer.from(e))}writeArray(e,t){this.maybeResize(),this.writeU32(e.length);for(const r of e)this.maybeResize(),t(r)}toArray(){return this.buf.subarray(0,this.length)}}s.BinaryWriter=z;function d(n,e,t){const r=t.value;t.value=function(...i){try{return r.apply(this,i)}catch(o){if(o instanceof RangeError){const a=o.code;if(["ERR_BUFFER_OUT_OF_BOUNDS","ERR_OUT_OF_RANGE"].indexOf(a)>=0)throw new u("Reached the end of buffer when deserializing")}throw o}}}class c{constructor(e){this.buf=e,this.offset=0}readU8(){const e=this.buf.readUInt8(this.offset);return this.offset+=1,e}readU16(){const e=this.buf.readUInt16LE(this.offset);return this.offset+=2,e}readU32(){const e=this.buf.readUInt32LE(this.offset);return this.offset+=4,e}readU64(){const e=this.readBuffer(8);return new b.default(e,"le")}readU128(){const e=this.readBuffer(16);return new b.default(e,"le")}readU256(){const e=this.readBuffer(32);return new b.default(e,"le")}readU512(){const e=this.readBuffer(64);return new b.default(e,"le")}readBuffer(e){if(this.offset+e>this.buf.length)throw new u(`Expected buffer length ${e} isn't within bounds`);const t=this.buf.slice(this.offset,this.offset+e);return this.offset+=e,t}readString(){const e=this.readU32(),t=this.readBuffer(e);try{return S.decode(t)}catch(r){throw new u(`Error decoding UTF-8 string: ${r}`)}}readFixedArray(e){return new Uint8Array(this.readBuffer(e))}readArray(e){const t=this.readU32(),r=Array();for(let i=0;i<t;++i)r.push(e());return r}}l([d],c.prototype,"readU8",null);l([d],c.prototype,"readU16",null);l([d],c.prototype,"readU32",null);l([d],c.prototype,"readU64",null);l([d],c.prototype,"readU128",null);l([d],c.prototype,"readU256",null);l([d],c.prototype,"readU512",null);l([d],c.prototype,"readString",null);l([d],c.prototype,"readFixedArray",null);l([d],c.prototype,"readArray",null);s.BinaryReader=c;function m(n){return n.charAt(0).toUpperCase()+n.slice(1)}function g(n,e,t,r,i){try{if(typeof r=="string")i[`write${m(r)}`](t);else if(r instanceof Array)if(typeof r[0]=="number"){if(t.length!==r[0])throw new u(`Expecting byte array of length ${r[0]}, but got ${t.length} bytes`);i.writeFixedArray(t)}else if(r.length===2&&typeof r[1]=="number"){if(t.length!==r[1])throw new u(`Expecting byte array of length ${r[1]}, but got ${t.length} bytes`);for(let o=0;o<r[1];o++)g(n,null,t[o],r[0],i)}else i.writeArray(t,o=>{g(n,e,o,r[0],i)});else if(r.kind!==void 0)switch(r.kind){case"option":{t==null?i.writeU8(0):(i.writeU8(1),g(n,e,t,r.type,i));break}default:throw new u(`FieldType ${r} unrecognized`)}else R(n,t,i)}catch(o){throw o instanceof u&&o.addToFieldPath(e),o}}function R(n,e,t){if(typeof e.borshSerialize=="function"){e.borshSerialize(t);return}const r=n.get(e.constructor);if(!r)throw new u(`Class ${e.constructor.name} is missing in schema`);if(r.kind==="struct")r.fields.map(([i,o])=>{g(n,i,e[i],o,t)});else if(r.kind==="enum"){const i=e[r.field];for(let o=0;o<r.values.length;++o){const[a,w]=r.values[o];if(a===i){t.writeU8(o),g(n,a,e[a],w,t);break}}}else throw new u(`Unexpected schema kind: ${r.kind} for ${e.constructor.name}`)}function M(n,e,t=z){const r=new t;return R(n,e,r),r.toArray()}s.serialize=M;function U(n,e,t,r){try{if(typeof t=="string")return r[`read${m(t)}`]();if(t instanceof Array){if(typeof t[0]=="number")return r.readFixedArray(t[0]);if(typeof t[1]=="number"){const i=[];for(let o=0;o<t[1];o++)i.push(U(n,null,t[0],r));return i}else return r.readArray(()=>U(n,e,t[0],r))}return t.kind==="option"?r.readU8()?U(n,e,t.type,r):void 0:B(n,t,r)}catch(i){throw i instanceof u&&i.addToFieldPath(e),i}}function B(n,e,t){if(typeof e.borshDeserialize=="function")return e.borshDeserialize(t);const r=n.get(e);if(!r)throw new u(`Class ${e.name} is missing in schema`);if(r.kind==="struct"){const i={};for(const[o,a]of n.get(e).fields)i[o]=U(n,o,a,t);return new e(i)}if(r.kind==="enum"){const i=t.readU8();if(i>=r.values.length)throw new u(`Enum index: ${i} is out of range`);const[o,a]=r.values[i],w=U(n,o,a,t);return new e({[o]:w})}throw new u(`Unexpected schema kind: ${r.kind} for ${e.constructor.name}`)}function L(n,e,t,r=c){const i=new r(t),o=B(n,e,i);if(i.offset<t.length)throw new u(`Unexpected ${t.length-i.offset} bytes after deserialized data`);return o}s.deserialize=L;function j(n,e,t,r=c){const i=new r(t);return B(n,e,i)}s.deserializeUnchecked=j;export{s as l};
